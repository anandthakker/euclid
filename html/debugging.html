
<section id="home">
  <svg class="geometry-scene" viewbox="0 0 800 800">
  </svg>
  <div id="scene-data">
  </div>
</section>

<script charset="utf-8">

function init() {
  var Scene = geom.Scene;
  
  var svg = document.querySelector('svg');
  var viewBox = svg.viewBox.baseVal,
      width = viewBox.width,
      height = viewBox.height;
  var scene = new Scene({
    left: viewBox.x,
    top: viewBox.y,
    right: viewBox.x + width,
    bottom: viewBox.y + height
  })
  var render = geom.renderer(scene, svg);
  
  scene
  .point(width/7*3, height/2)
  .point(width/7*4, height/2)
  .point(width/7*5, height/3)
  .segment(0,1)
  .segment(1,2)
  .segment(2,0)
  .circle(0,1)
  .circle(1,0)
  

  function showData() {
    scene.logState();
    
    var log = scene.log.slice(-2),
        elem = document.querySelector('#scene-data');
    
    for(var i = 0; i < log.length; i++) {
      var pre = document.createElement('pre');
      pre.innerHTML =
        'intersections: ' + log[i].intersections + '\n' +
        'objects: '+log[i].objects.length + '\n' +
        log[i].objects.join('\n');
      if(i < elem.children.length)
        elem.replaceChild(pre, elem.children[i]);
      else
        elem.appendChild(pre);
    }
    
  }
  
  function update() {
    scene.updateIntersections();
    showData();
    render();
    d3.selectAll('.free-point').call(geom.behavior.move.point(update));
    d3.selectAll('.circle').call(geom.behavior.move.circle(update));
    d3.selectAll('.line').call(geom.behavior.move.line(update));
  }
    
  update();
}

document.addEventListener('DOMContentLoaded', init)
</script>
